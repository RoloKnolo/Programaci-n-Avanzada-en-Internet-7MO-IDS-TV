<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
	<style type="text/css">
		body{
			width: 100%;
			height: 100%;
		}
		canvas{
			margin: auto; 
		} 
	</style>
</head>
<body>
    <canvas id="mycanvas" width="500" height="500" style="border: 1px solid #000">
	</canvas>
	<script type="text/javascript">
		var cv = null;
		var ctx = null;
		var player1 = null;
		var player2 = null;
		var super_x = 240, super_y = 240;
		var direction = 'right';
		var score = 0;
		var speed = 2;
		var pause = false;
		var pared = null;

		var gato = new Image();
		var raton = new Image();
		var miau = new Audio();
		function start()
		{
			cv = document.getElementById('mycanvas');
			ctx = cv.getContext('2d');
			player1 = new Cuadrado(super_x,super_y,40,40,'red');
			player2 = new Cuadrado(generateRandomInteger(500),generateRandomInteger(500),40,40,'blue');
		//  pared = new Cuadrado(30,300)
			gato.src = 'gato.png';
			raton.src = 'raton.png';
			miau.src = 'miau.mp3';
			paint();
		} 
		function paint()
		{
			window.requestAnimationFrame(paint)
			ctx.fillStyle = "white";
			ctx.fillRect(0,0,500,500);
			ctx.fillStyle = "black";
			ctx.fillText('SCORE:'+score+'  SPEED:'+speed,30,20);

			// player1.dibujar(ctx);
			ctx.drawImage(gato,player1.x,player1.y);
			// player2.dibujar(ctx);
			ctx.drawImage(raton,player2.x,player2.y);
			//pared
			//ctx.drawImage(wall,pared.x,pared.y,30,300);
			if (pause) {
				ctx.fillStyle = "rgba(0,0,0,0.5)"
				ctx.fillRect(0,0,500,500)
				ctx.fillStyle = "white";
				ctx.fillText('P A U S E',230,230);
			}else{
				update();
			}
			
		}
		function update()
		{
			
			if (direction == 'right') {
				player1.x += speed;
				if (player1.x>500) {
					player1.x = 0;
				}
			}
			if (direction == 'left') {
				player1.x -= speed;
				if (player1.x<0) {
					player1.x = 500;
				}
			}
			
			if (direction == 'down') {
				player1.y += speed;
				if (player1.y>500) {
					player1.y = 0;
				}
			}
			if (direction == 'up') {
				player1.y -= speed;
				if (player1.y<0) {
					player1.y = 500;
				}
			}
			if (player1.se_tocan(player2)) {
				miau.play();
				player2.x = generateRandomInteger(460);
				player2.y = generateRandomInteger(460);
				score += 1;
				if(score % 5 == 0){
				speed += 1;
				}
			}
			if(player1.se_tocan(pared)){
				if (direction == 'right') {
				player1.x += speed;
			}
			if (direction == 'left') {
				player1.x -= speed;
			}
			
			if (direction == 'down') {
				player1.y += speed;
			}
			if (direction == 'up') {
				player1.y -= speed;
			}
			}
			
		}

		document.addEventListener('keydown',function(e){
			//console.log(e)
			//arriba
			if (e.which == 87 || e.which == 38) {
				direction = 'up';
			}
			//abajo
			if (e.which == 83 || e.which == 40) {
				direction = 'down';
			}
			//izquierda
			if (e.which == 65 || e.which == 37) {
				direction = 'left';
			}
			//derecha
			if (e.which == 68 || e.which == 39) {
				direction = 'right';
			}
			//pause
			if (e.which == 32  ) { 
				pause = (pause)?false:true;
			}
			//Reiniciar
			if(e.which == 82){
				player1.x = super_x;
				player1.y = super_y;
				player2.x = generateRandomInteger(460);
				player2.y = generateRandomInteger(460);
				score = 0;
				speed = 2;
				direction = 'right';
			}
		})
		window.addEventListener('load',start)
		window.requestAnimationFrame = (function () {
		    return window.requestAnimationFrame ||
		        window.webkitRequestAnimationFrame ||
		        window.mozRequestAnimationFrame ||
		        function (callback) {
		            window.setTimeout(callback, 17);
		        };
		}());
		function Cuadrado(x,y,w,h,c)
		{
			this.x = x;
			this.y = y;
			this.w = w;
			this.h = h;
			this.c = c;
			this.se_tocan = function (target) { 
				if(this.x < target.x + target.w &&
				   this.x + this.w > target.x && 
				   this.y < target.y + target.h && 
				   this.y + this.h > target.y)
				{
					return true;  
				}  
			};
			this.dibujar = function(ctx){
				ctx.fillStyle = this.c;
				ctx.fillRect(this.x,this.y,this.w,this.h);
				ctx.strokeRect(this.x,this.y,this.w,this.h);
			}
		}
		function random_rgba() {
		    var o = Math.round, r = Math.random, s = 255;
		    return 'rgba(' + o(r()*s) + ',' + o(r()*s) + ',' + o(r()*s) + ',' + r().toFixed() + ')';
		}
		function generateRandomInteger(max) {
			return Math.floor(Math.random() * max) + 1;
		}
	</script>
</body>
</html>